#include "Mesh.hpp"

namespace ogfx
{
	using namespace ostd;

	void Mesh::initialize(void)
	{
		vao.create();
		auto layout = tVertex::getVertexBufferLayout();
		vbo.create(&vertices[0], vertices.size() * layout.getStride());
		vao.addBuffer(vbo, layout);
		ebo.create(&indices[0], indices.size());
		vao.setElementBuffer(ebo);
	}

	void Mesh::bind(void)
	{
		vao.bind();
	}

	void Mesh::unbind(void)
	{
		vao.unbind();
	}

	void Mesh::draw(void)
	{
		glDrawElements(GL_TRIANGLES, ebo.getElementCount(), GL_UNSIGNED_INT, 0);
	}

	Mesh Mesh::newPlaneMesh(bool auto_initialize)
	{
		Mesh plane;
		plane.indices = { 0, 1, 3, 1, 2, 3 };
		plane.vertices = {
			tVertex { { 1.0f,  1.0f, 0.0f},	 {1.0f, 1.0f, 1.0f, 1.0f},		 {1.0f, 1.0f},	{0.0f, 0.0f, 1.0f}},
			tVertex { { 1.0f, -1.0f, 0.0f},	 {1.0f, 1.0f, 1.0f, 1.0f},		 {1.0f, 0.0f},	{0.0f, 0.0f, 1.0f}},
			tVertex { {-1.0f, -1.0f, 0.0f},	 {1.0f, 1.0f, 1.0f, 1.0f},		 {0.0f, 0.0f},	{0.0f, 0.0f, 1.0f}},
			tVertex { {-1.0f,  1.0f, 0.0f},	 {1.0f, 1.0f, 1.0f, 1.0f},		 {0.0f, 1.0f},	{0.0f, 0.0f, 1.0f}}
		};
		if (auto_initialize) plane.initialize();
		return plane;
	}

	Mesh Mesh::newCubeMesh(bool auto_initialize)
	{
		Mesh cube;
		cube.indices = { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 0, 18, 1, 3, 19, 4, 6, 20, 7, 9, 21, 10, 12, 22, 13, 15, 23, 16 };
		cube.vertices = {
			tVertex { { -1.000000, 1.000000, 1.000000 },    {1.0, 1.0, 1.0, 1.0},   { 0.875000, 0.500000 }, { 0.000000, 0.000000, 1.000000 } },
			tVertex { { 1.000000, -1.000000, 1.000000 },    {1.0, 1.0, 1.0, 1.0},   { 0.625000, 0.750000 }, { 0.000000, 0.000000, 1.000000 } },
			tVertex { { 1.000000, 1.000000, 1.000000 },     {1.0, 1.0, 1.0, 1.0},   { 0.625000, 0.500000 }, { 0.000000, 0.000000, 1.000000 } },
			tVertex { { 1.000000, -1.000000, 1.000000 },    {1.0, 1.0, 1.0, 1.0},   { 0.625000, 0.750000 }, { 0.000000, -1.000000, 0.000000 } },
			tVertex { { -1.000000, -1.000000, -1.000000 },  {1.0, 1.0, 1.0, 1.0},   { 0.375000, 1.000000 }, { 0.000000, -1.000000, 0.000000 } },
			tVertex { { 1.000000, -1.000000, -1.000000 },   {1.0, 1.0, 1.0, 1.0},   { 0.375000, 0.750000 }, { 0.000000, -1.000000, 0.000000 } },
			tVertex { { -1.000000, -1.000000, 1.000000 },   {1.0, 1.0, 1.0, 1.0},   { 0.625000, 0.000000 }, { -1.000000, 0.000000, 0.000000 } },
			tVertex { { -1.000000, 1.000000, -1.000000 },   {1.0, 1.0, 1.0, 1.0},   { 0.375000, 0.250000 }, { -1.000000, 0.000000, 0.000000 } },
			tVertex { { -1.000000, -1.000000, -1.000000 },  {1.0, 1.0, 1.0, 1.0},   { 0.375000, 0.000000 }, { -1.000000, 0.000000, 0.000000 } },
			tVertex { { 1.000000, 1.000000, -1.000000 },    {1.0, 1.0, 1.0, 1.0},   { 0.375000, 0.500000 }, { 0.000000, 0.000000, -1.000000 } },
			tVertex { { -1.000000, -1.000000, -1.000000 },  {1.0, 1.0, 1.0, 1.0},   { 0.125000, 0.750000 }, { 0.000000, 0.000000, -1.000000 } },
			tVertex { { -1.000000, 1.000000, -1.000000 },   {1.0, 1.0, 1.0, 1.0},   { 0.125000, 0.500000 }, { 0.000000, 0.000000, -1.000000 } },
			tVertex { { 1.000000, 1.000000, 1.000000 },     {1.0, 1.0, 1.0, 1.0},   { 0.625000, 0.500000 }, { 1.000000, 0.000000, 0.000000 } },
			tVertex { { 1.000000, -1.000000, -1.000000 },   {1.0, 1.0, 1.0, 1.0},   { 0.375000, 0.750000 }, { 1.000000, 0.000000, 0.000000 } },
			tVertex { { 1.000000, 1.000000, -1.000000 },    {1.0, 1.0, 1.0, 1.0},   { 0.375000, 0.500000 }, { 1.000000, 0.000000, 0.000000 } },
			tVertex { { -1.000000, 1.000000, 1.000000 },    {1.0, 1.0, 1.0, 1.0},   { 0.625000, 0.250000 }, { 0.000000, 1.000000, 0.000000 } },
			tVertex { { 1.000000, 1.000000, -1.000000 },    {1.0, 1.0, 1.0, 1.0},   { 0.375000, 0.500000 }, { 0.000000, 1.000000, 0.000000 } },
			tVertex { { -1.000000, 1.000000, -1.000000 },   {1.0, 1.0, 1.0, 1.0},   { 0.375000, 0.250000 }, { 0.000000, 1.000000, 0.000000 } },
			tVertex { { -1.000000, -1.000000, 1.000000 },   {1.0, 1.0, 1.0, 1.0},   { 0.875000, 0.750000 }, { 0.000000, 0.000000, 1.000000 } },
			tVertex { { -1.000000, -1.000000, 1.000000 },   {1.0, 1.0, 1.0, 1.0},   { 0.625000, 1.000000 }, { 0.000000, -1.000000, 0.000000 } },
			tVertex { { -1.000000, 1.000000, 1.000000 },    {1.0, 1.0, 1.0, 1.0},   { 0.625000, 0.250000 }, { -1.000000, 0.000000, 0.000000 } },
			tVertex { { 1.000000, -1.000000, -1.000000 },   {1.0, 1.0, 1.0, 1.0},   { 0.375000, 0.750000 }, { 0.000000, 0.000000, -1.000000 } },
			tVertex { { 1.000000, -1.000000, 1.000000 },    {1.0, 1.0, 1.0, 1.0},   { 0.625000, 0.750000 }, { 1.000000, 0.000000, 0.000000 } },
			tVertex { { 1.000000, 1.000000, 1.000000 },     {1.0, 1.0, 1.0, 1.0},   { 0.625000, 0.500000 }, { 0.000000, 1.000000, 0.000000 } }
		};
		if (auto_initialize) cube.initialize();
		return cube;
	}
}